#!/usr/bin/env python3

'''
To prevent CI failing for approved instance of banned words, add a comment: #[allow(panic)] on the previous line
'''

import os

banned = ["unwrap(", "panic!("]

srcs = os.listdir("src")
print("Files to check: %s" % srcs)

failed = False
allow = False
for f in srcs:
    with open("src/" + f) as src_file:
        for line_no, line in enumerate(src_file):
            if "#[allow(panic)]" in line:
                allow = True
                continue
            for b in banned:
                if b not in line or allow == True:
                    continue
                failed = True
                print("File %s on line number  %s calls banned function: %s)" % (f, line_no + 1, b))
            allow = False
            pass
exit(failed)
